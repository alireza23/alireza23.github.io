<!DOCTYPE html>
<html>

<head>
    <!-- <script class="jsbin" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script> -->
    <meta charset=utf-8 />
    <title>Avinash</title>

    <style>
        body {
            margin: 0px;
            padding: 0px;
            /* overflow: hidden; */
        }
        
        #myImage {
            display: none;
            position: absolute;
            top: 0;
            opacity: 1;
        }
        
        #canvas {
            position: absolute;
            top: 0;
        }
    </style>
</head>

<body>
    <div id="dragWrapper">
        <img id="myImage" src="./superCompact.jpg" alt="">
        <canvas id="canvas"></canvas>
    </div>

    <script>
        var pointerType;
        window.onload = function() {
            var parent = document.getElementById("dragWrapper");
            var img = document.getElementById("myImage");
            var canvas = document.getElementById('canvas');
            var ctx = canvas.getContext('2d');
            var width = window.innerWidth;
            var height = window.innerHeight;
            canvas.width = width;
            var imageNaturalWidth = img.naturalWidth
            var imageNaturalHeight = img.naturalHeight
            var desiredHeight = (width * imageNaturalHeight) / imageNaturalWidth;
            canvas.height = desiredHeight;
            img.style.width = window.innerWidth + 'px';
            img.style.height = desiredHeight + 'px';
            img.style.display = 'block'
            ctx.globalAlpha = 0;
            ctx.drawImage(img, 0, 0, width, desiredHeight);
            ctx.globalAlpha = 1;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.shadowBlur = 2;
            ctx.shadowOffsetX = 1;
            ctx.shadowOffsetY = 1;
            ctx.shadowColor = "#0d486e";
            ctx.strokeStyle = '#186699';

            parent.addEventListener('mousedown', function(e) {
                console.log('parent mouse down')
            }, false)

            canvas.addEventListener('mousedown', function(e) {
                ctx.globalCompositeOperation = 'source-over'
                console.log('canvas mouse down')
                this.down = true;
                this.X = e.pageX;
                this.Y = e.pageY;
                ctx.shadowBlur = 4;
                ctx.shadowOffsetX = 2;
                ctx.shadowOffsetY = 2;
                ctx.shadowColor = "black";
                ctx.beginPath();
                ctx.moveTo(this.X, this.Y);
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                ctx.lineWidth = 10;
                ctx.strokeStyle = '#9b59b6';

                // this.color = rgb();
            }, false);

            canvas.addEventListener('mouseup', function() {
                this.down = false;
            }, 0);
            canvas.addEventListener('mousemove', function(e) {
                this.style.cursor = 'pointer';
                if (this.down) {
                    ctx.lineTo(e.pageX, e.pageY);
                    ctx.stroke();
                    this.X = e.pageX;
                    this.Y = e.pageY;
                }
            }, 0);
            canvas.addEventListener('touchstart', function(e) {
                console.log(e)

                this.down = true;
                this.X = e.touches[0].pageX;
                this.Y = e.touches[0].pageY;


                if (pointerType == 'pen') {
                    ctx.globalCompositeOperation = 'source-over'
                    ctx.lineWidth = 5;
                    e.preventDefault()
                } else if (pointerType == 'touch' && e.touches.length == 1) {
                    ctx.globalCompositeOperation = 'destination-out'
                    ctx.lineWidth = 45;
                    e.preventDefault()

                }
                ctx.beginPath();
                ctx.moveTo(this.X, this.Y);

            }, 0);
            canvas.addEventListener('touchend', function(e) {
                this.down = false;
                e.preventDefault()
            }, 0);
            canvas.addEventListener('touchmove', function(e) {
                this.style.cursor = 'pointer';
                e.preventDefault()
                if (this.down) {
                    ctx.lineTo(e.touches[0].pageX, e.touches[0].pageY);
                    ctx.stroke();
                    this.X = e.touches[0].pageX;
                    this.Y = e.touches[0].pageY;
                }
            }, 0);

            canvas.addEventListener('pointerdown', function(e) {
                console.log(e)
                pointerType = e.pointerType

            })
        };
    </script>
</body>

</html>